!function e(t,n,a){function o(s,r){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!r&&c)return c(s,!0);if(i)return i(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return o(n?n:e)},l,l.exports,e,t,n,a)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<a.length;s++)o(a[s]);return o}({1:[function(e,t,n){var a=window.location.protocol+"//"+window.location.host+"/";"w.yuema.us"===window.location.hostname&&(a=window.location.protocol+"//www.yuema.us/");var o={loginApi:a+"open-api/login",registApi:a+"open-api/simple-regist",perfectApi:a+"action/user/update",provincesListApi:a+"open-api/query/provinces-list",citiesListApi:a+"open-api/query/cities-list",addressesListApi:a+"open-api/query/addresses-list",postDatingApi:a+"action/dating/post",requestDatingApi:a+"action/dating/request",acceptDatingApi:a+"action/dating/accept",listApi:a+"open-api/query/dating/dating-list",profileApi:a+"open-api/query/home-info",myRequestApi:a+"action/query/dating/my-request-dating-list",datingDetailApi:a+"open-api/query/dating/dating-info",chatRecordsApi:a+"action/query/message/message-list"};t.exports=o},{}],2:[function(e,t,n){var a={getUrlParam:function(e){var t=new RegExp("[?|&]"+e+"=([^&]+)"),n=location.search.match(t);return n&&n[1]},stopEventTap:function(){var e=$('<div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 99999; "></div>');$("body").append(e),setTimeout(function(){e.remove()},500)},formatDate:function(e){"string"==typeof e&&(e=this.strToDate(e));var t=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();return 10>n&&(n="0"+n),10>a&&(a="0"+a),t+"-"+n+"-"+a},strToDate:function(e){var t=e.replace(/-/g,"/");return new Date(t)},hideKeyboard:function(){var e=$('<a style="width: 0;height: 0;font-size: 0;display: block"></a>');$("body").append(e),e.focus(),setTimeout(function(){e.remove()},0)},getNetworkState:function(){var e=150,t=!1;if(window.performance){var n=window.performance.timing,a=n.responseEnd-n.domainLookupStart;t=a>e?!1:!0}return t},isIOS:function(){var e=ua.match(/(iPad).*OS\s([\d_]+)/),t=ua.match(/(iPod)(.*OS\s([\d_]+))?/),n=!e&&ua.match(/(iPhone\sOS)\s([\d_]+)/);return e||n||t?!0:!1},isAndroid:function(){return ua.indexOf("Android")>-1},isWeixin:function(){return ua.indexOf("MicroMessenger")>-1},getCookie:function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=document.cookie.match(t);return null!=n?decodeURI(n[2]):""},isLogin:function(){var e=this,t=e.getCookie("logined");return""!==t?!0:!1},template:function(e,t){function n(e){if(!e)return"";var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};return(""+e).replace(/[&<>"']/g,function(e){return t[e]})}var a,o={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},i=/'|\\|\r|\n|\t|\u2028|\u2029/g,s=/<%-([\s\S]+?)%>|<%=([\s\S]+?)%>|<%([\s\S]+?)%>|$/g,r=0,c="__p+='";e.replace(s,function(t,a,s,d,l){return c+=e.slice(r,l).replace(i,function(e){return"\\"+o[e]}),a&&(c+="'+\n((__t=("+a+"))==null?'':"+n.name+"(__t))+\n'"),s&&(c+="'+\n((__t=("+s+"))==null?'':__t)+\n'"),d&&(c+="';\n"+d+"\n__p+='"),r=l+t.length,t}),c+="';\n",c="with(obj||{}){\n"+c+"}\n",c=n.toString()+"var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+c+"return __p;\n";try{a=new Function("obj",c)}catch(d){throw d.source=c,d}if(t)return a(t);var l=function(e){return a(e)};return l.source="function(obj){\n"+c+"}",l}};t.exports=a},{}],3:[function(e,t,n){var a=function(e){1==e.isRedirect&&setTimeout(function(){window.location.href=e.redirectURL},2e3)};t.exports={post:function(e,t,n,o){$.ajax({url:e,data:t,type:"post",dataType:"json",success:function(e){a(e),"SUCCESS"===e.resultCode?n(e):o(e)},error:function(e){var t=(e.status||500,"对不起，服务器正在维护，请稍后再试...");switch(e.status){case 404:t="对不起，你访问的接口不存在...";break;case 403:t="对不起，你没有权限访问该接口...";break;case 500:t="对不起，正在进行服务器维护，请稍后再来...";break;case 502:t="对不起，你访问的接口程序出错...";break;case 503:t="对不起，你访问的接口后端异常...";break;default:t="对不起，服务器正在维护，请稍后再试..."}var e={isRedirect:!1,result:{},resultCode:"SERVER ERROR",resultMsg:t};o(e)}})},get:function(e,t,n,o){$.ajax({url:e,data:t,type:"get",dataType:"json",success:function(e){a(e),"SUCCESS"===e.resultCode?n(e):o(e)},error:function(e){var t=(e.status||500,"对不起，服务器正在维护，请稍后再试...");switch(e.status){case 404:t="对不起，你访问的接口不存在...";break;case 403:t="对不起，你没有权限访问该接口...";break;case 500:t="对不起，正在进行服务器维护，请稍后再来...";break;case 502:t="对不起，你访问的接口程序出错...";break;case 503:t="对不起，你访问的接口后端异常...";break;default:t="对不起，服务器正在维护，请稍后再试..."}var e={isRedirect:!1,result:{},resultCode:"ERROR",resultMsg:t};o(e)}})}}},{}],4:[function(e,t,n){t.exports={hide:function(){$(".preloader-indicator-overlay, .preloader-indicator-modal, .preloader-label").remove()},show:function(e){var t="数据加载中...";if("object"==typeof e){t=e.msg||t;var n=$(e.renderTo),a=$('<div class="preloader-label"></div>'),o=$('<span class="preloader"></span>'),i=$('<span class="msg">'+t+"</span>");o.appendTo(a),i.appendTo(a),0===n.find(".preloader-label").length&&a.appendTo(n);var s=parseInt(i.width());a.css("width",s+25+1+"px")}else{t=e||t;var r=$('<div class="preloader-indicator-overlay"></div>'),c=$('<div class="preloader-indicator-modal"></div>'),o=$('<span class="preloader preloader-white"></span>'),i=$('<span class="msg">'+t+"</span>");o.appendTo(c),i.appendTo(c),r.appendTo($("body")),c.appendTo($("body"));var s=parseInt(c.width())/2,d=parseInt(c.height())/2;o.css("marginLeft",s-25+"px"),c.css({marginLeft:"-"+s+"px",marginTop:"-"+d+"px"})}}}},{}],5:[function(e,t,n){var a=$("body"),o=$('<div class="dialog-overlay"></div>'),i=$('<div class="dialog"></div>');t.exports={_initModal:function(){o=$('<div class="dialog-overlay"></div>'),i=$('<div class="dialog dialog-no-buttons"></div>'),a.append(o),a.append(i)},_hide:function(){i.addClass("dialog-out"),o.removeClass("dialog-overlay-visible"),setTimeout(function(){o.remove(),i.remove()},200)},_show:function(){o.addClass("dialog-overlay-visible"),i.addClass("dialog-in")},_position:function(){var e=parseInt(i.height())/2;i.css("marginTop","-"+e+"px")},show:function(e){var t=this,n=$('<div class="dialog-inner"></div>');t._initModal();var a=e.text||"",o=e.title||"";msgType=e.type||"success",callback=e.callback||null,"success"===msgType&&""===o&&(o="成功"),"error"===msgType&&""===o&&(o="失败");var s=$('<div class="iconfont icon-'+msgType+'"></div>'),r=$('<div class="dialog-title">'+o+"</div>"),c=$('<div class="dialog-text">'+a+"</div>");n.append(s),n.append(r),n.append(c),i.append(n),setTimeout(function(){t._hide(),callback&&callback()},2e3),t._position(),t._show()}}},{}],6:[function(e,t,n){$(function(){var t=e("../../common/utils"),n=e("../../common/apimap"),a=e("../../components/tips"),o=e("../../components/ajax"),i=e("../../components/loading/loading"),s=t.getUrlParam("uid")||"",r=t.getUrlParam("did")||"",c={socket:null,init:function(){if(!t.isLogin())return window.location.href="./login.html",!1;var e=$(window).height()-50;$(".chat-messages").height(e),this.getDetail(),this.getData(),"http:"==window.location.protocol?c.connect("ws://"+window.location.host+"/websocket/chat/"+r+"/"+s):c.connect("wss://"+window.location.host+"/websocket/chat/"+r+"/"+s)},connect:function(e){var t=this;if("WebSocket"in window)c.socket=new WebSocket(e);else{if(!("MozWebSocket"in window))return void a.show({type:"error",title:"Error: WebSocket is not supported by this browser."});c.socket=new MozWebSocket(e)}c.socket.onopen=function(){t.initEvent()},c.socket.onclose=function(){document.getElementById("message").onkeydown=null,a.show({type:"error",title:"Info: WebSocket closed."})},c.socket.onmessage=function(e){var n=JSON.parse(e.data);t.addMessage(n)}},sendMessage:function(){var e=$.trim($("#message").val()),t={message:e,userId:s,datingId:r};e&&s&&r&&(c.socket.send(JSON.stringify(t)),$("#message").val(""))},addMessage:function(e){var t=$(".chat-messages"),n=$(".chat-messages-list"),a=$("<li/>").addClass("chat-message "+(e.self?"chat-message-self":"chat-message-friend")).appendTo(n),o=$("<div/>").addClass("chat-message-avatar").appendTo(a),i=$("<div/>").addClass("chat-message-bubble").appendTo(a);return o.html('<a href="./profile.html?id='+e.fromUserId+'"><img src="'+e.avatar+'_s60" alt="" /></a>'),i.html(e.message||e.msg),t.scrollTop(9999999),{$container:a,$bubble:i}},initEvent:function(){document.addEventListener("DOMContentLoaded",function(){for(var e=document.getElementsByClassName("noscript"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},!1),document.getElementById("message").onkeydown=function(e){13==e.keyCode&&c.sendMessage()},$(document).on("tap","#sendBtn",function(){c.sendMessage()})},getDetail:function(){var e={2:"icon-coffee",3:"icon-food",4:"icon-film",5:"icon-run",6:"icon-photo",7:"icon-badminton",8:"icon-riding",9:"icon-drive",11:"icon-flight",1:"icon-lquote"},t={2:"喝咖啡/茶",3:"美食",4:"看电影",5:"跑步",6:"摄影",7:"羽毛球",8:"骑行",9:"自驾",11:"同行",1:"其他"};apiData={userId:s,datingId:r},i.show(),o.get(n.datingDetailApi,apiData,function(n){if(i.hide(),n.result&&n.result.datingInfo){var o=n.result.datingInfo,s=o.datingTime||"",r=o.typeId;if(""!==s)var c=s.substr(0,10);else var c="随时";var d='<li class="chat-message chat-message-theme"><div class="chat-message-bubble"><span class="label"><span class="iconfont icon-lquote"></span> 约吗？</span><br /><span>'+o.article+'</span><br /><span class="what"><span class="iconfont '+e[r]+'"></span>'+t[r]+'</span><span class="time"><span class="iconfont icon-calendar"></span>'+c+"</span></div></li>";$(".chat-messages-list").prepend(d)}else a.show({type:"error",title:"返回的约会数据格式有问题"})},function(e){i.hide()})},getData:function(){var e=this;apiData={userId:s,datingId:r},i.show(),o.get(n.chatRecordsApi,apiData,function(t){if(i.hide(),t.result&&t.result.messageList){var n=t.result.messageList;if(n.length>0)for(var o=0,s=n.length;s>o;o++)e.addMessage(n[o])}else a.show({type:"error",title:"返回的聊天数据格式有问题"})},function(e){i.hide()})}};c.init()})},{"../../common/apimap":1,"../../common/utils":2,"../../components/ajax":3,"../../components/loading/loading":4,"../../components/tips":5}]},{},[6]);