!function e(t,n,a){function i(s,r){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!r&&c)return c(s,!0);if(o)return o(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,a)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(e,t,n){var a=window.location.protocol+"//"+window.location.host+"/";"w.yuema.us"===window.location.hostname&&(a=window.location.protocol+"//www.yuema.us/");var i={loginApi:a+"open-api/login",registApi:a+"open-api/simple-regist",perfectApi:a+"action/user/update",provincesListApi:a+"open-api/query/provinces-list",citiesListApi:a+"open-api/query/cities-list",addressesListApi:a+"open-api/query/addresses-list",postDatingApi:a+"action/dating/post",requestDatingApi:a+"action/dating/request",acceptDatingApi:a+"action/dating/accept",listApi:a+"open-api/query/dating/dating-list",profileApi:a+"open-api/query/home-info",myRequestApi:a+"action/query/dating/my-request-dating-list",datingDetailApi:a+"open-api/query/dating/dating-info",chatRecordsApi:a+"action/query/message/message-list"};t.exports=i},{}],2:[function(e,t,n){var a={getUrlParam:function(e){var t=new RegExp("[?|&]"+e+"=([^&]+)"),n=location.search.match(t);return n&&n[1]},stopEventTap:function(){var e=$('<div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 99999; "></div>');$("body").append(e),setTimeout(function(){e.remove()},500)},formatDate:function(e){"string"==typeof e&&(e=this.strToDate(e));var t=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();return 10>n&&(n="0"+n),10>a&&(a="0"+a),t+"-"+n+"-"+a},strToDate:function(e){var t=e.replace(/-/g,"/");return new Date(t)},hideKeyboard:function(){var e=$('<a style="width: 0;height: 0;font-size: 0;display: block"></a>');$("body").append(e),e.focus(),setTimeout(function(){e.remove()},0)},getNetworkState:function(){var e=150,t=!1;if(window.performance){var n=window.performance.timing,a=n.responseEnd-n.domainLookupStart;t=a>e?!1:!0}return t},isIOS:function(){var e=window.navigator.userAgent,t=e.match(/(iPad).*OS\s([\d_]+)/),n=e.match(/(iPod)(.*OS\s([\d_]+))?/),a=!t&&e.match(/(iPhone\sOS)\s([\d_]+)/);return t||a||n?!0:!1},isAndroid:function(){var e=window.navigator.userAgent;return e.indexOf("Android")>-1},isWeixin:function(){var e=window.navigator.userAgent;return e.indexOf("MicroMessenger")>-1},getCookie:function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=document.cookie.match(t);return null!=n?decodeURI(n[2]):""},isLogin:function(){var e=this,t=e.getCookie("logined");return""!==t?!0:!1},template:function(e,t){function n(e){if(!e)return"";var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};return(""+e).replace(/[&<>"']/g,function(e){return t[e]})}var a,i={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},o=/'|\\|\r|\n|\t|\u2028|\u2029/g,s=/<%-([\s\S]+?)%>|<%=([\s\S]+?)%>|<%([\s\S]+?)%>|$/g,r=0,c="__p+='";e.replace(s,function(t,a,s,d,l){return c+=e.slice(r,l).replace(o,function(e){return"\\"+i[e]}),a&&(c+="'+\n((__t=("+a+"))==null?'':"+n.name+"(__t))+\n'"),s&&(c+="'+\n((__t=("+s+"))==null?'':__t)+\n'"),d&&(c+="';\n"+d+"\n__p+='"),r=l+t.length,t}),c+="';\n",c="with(obj||{}){\n"+c+"}\n",c=n.toString()+"var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+c+"return __p;\n";try{a=new Function("obj",c)}catch(d){throw d.source=c,d}if(t)return a(t);var l=function(e){return a(e)};return l.source="function(obj){\n"+c+"}",l}};t.exports=a},{}],3:[function(e,t,n){var a=function(e){1==e.isRedirect&&setTimeout(function(){window.location.href=e.redirectURL},2e3)};t.exports={post:function(e,t,n,i){$.ajax({url:e,data:t,type:"post",dataType:"json",success:function(e){a(e),"SUCCESS"===e.resultCode?n(e):i(e)},error:function(e){var t=(e.status||500,"对不起，服务器正在维护，请稍后再试...");switch(e.status){case 404:t="对不起，你访问的接口不存在...";break;case 403:t="对不起，你没有权限访问该接口...";break;case 500:t="对不起，正在进行服务器维护，请稍后再来...";break;case 502:t="对不起，你访问的接口程序出错...";break;case 503:t="对不起，你访问的接口后端异常...";break;default:t="对不起，服务器正在维护，请稍后再试..."}var e={isRedirect:!1,result:{},resultCode:"SERVER ERROR",resultMsg:t};i(e)}})},get:function(e,t,n,i){$.ajax({url:e,data:t,type:"get",dataType:"json",success:function(e){a(e),"SUCCESS"===e.resultCode?n(e):i(e)},error:function(e){var t=(e.status||500,"对不起，服务器正在维护，请稍后再试...");switch(e.status){case 404:t="对不起，你访问的接口不存在...";break;case 403:t="对不起，你没有权限访问该接口...";break;case 500:t="对不起，正在进行服务器维护，请稍后再来...";break;case 502:t="对不起，你访问的接口程序出错...";break;case 503:t="对不起，你访问的接口后端异常...";break;default:t="对不起，服务器正在维护，请稍后再试..."}var e={isRedirect:!1,result:{},resultCode:"ERROR",resultMsg:t};i(e)}})}}},{}],4:[function(e,t,n){t.exports={hide:function(){$(".preloader-indicator-overlay, .preloader-indicator-modal, .preloader-label").remove()},show:function(e){var t="数据加载中...";if("object"==typeof e){t=e.msg||t;var n=$(e.renderTo),a=$('<div class="preloader-label"></div>'),i=$('<span class="preloader"></span>'),o=$('<span class="msg">'+t+"</span>");i.appendTo(a),o.appendTo(a),0===n.find(".preloader-label").length&&a.appendTo(n);var s=parseInt(o.width());a.css("width",s+25+1+"px")}else{t=e||t;var r=$('<div class="preloader-indicator-overlay"></div>'),c=$('<div class="preloader-indicator-modal"></div>'),i=$('<span class="preloader preloader-white"></span>'),o=$('<span class="msg">'+t+"</span>");i.appendTo(c),o.appendTo(c),r.appendTo($("body")),c.appendTo($("body"));var s=parseInt(c.width())/2,d=parseInt(c.height())/2;i.css("marginLeft",s-25+"px"),c.css({marginLeft:"-"+s+"px",marginTop:"-"+d+"px"})}}}},{}],5:[function(e,t,n){var a=$("body"),i=$('<div class="dialog-overlay"></div>'),o=$('<div class="dialog"></div>');t.exports={_initModal:function(){i=$('<div class="dialog-overlay"></div>'),o=$('<div class="dialog dialog-no-buttons"></div>'),a.append(i),a.append(o)},_hide:function(){o.addClass("dialog-out"),i.removeClass("dialog-overlay-visible"),setTimeout(function(){i.remove(),o.remove()},200)},_show:function(){i.addClass("dialog-overlay-visible"),o.addClass("dialog-in")},_position:function(){var e=parseInt(o.height())/2;o.css("marginTop","-"+e+"px")},show:function(e){var t=this,n=$('<div class="dialog-inner"></div>');t._initModal();var a=e.text||"",i=e.title||"";msgType=e.type||"success",callback=e.callback||null,"success"===msgType&&""===i&&(i="成功"),"error"===msgType&&""===i&&(i="失败");var s=$('<div class="iconfont icon-'+msgType+'"></div>'),r=$('<div class="dialog-title">'+i+"</div>"),c=$('<div class="dialog-text">'+a+"</div>");n.append(s),n.append(r),n.append(c),o.append(n),setTimeout(function(){t._hide(),callback&&callback()},2e3),t._position(),t._show()}}},{}],6:[function(e,t,n){$(function(){var t=e("../../common/utils"),n=e("../../common/apimap"),a=e("../../components/tips"),i=e("../../components/ajax"),o=e("../../components/loading/loading"),s=t.getUrlParam("uid")||"",r=t.getUrlParam("did")||"",c="",d={socket:null,init:function(){return t.isLogin()?(this.updateChatHeight(),this.getDetail(),this.getData(),void("http:"==window.location.protocol?d.connect("ws://"+window.location.host+"/websocket/chat/"+r+"/"+s):d.connect("wss://"+window.location.host+"/websocket/chat/"+r+"/"+s))):(window.location.href="./login.html",!1)},connect:function(e){var t=this;if("WebSocket"in window)d.socket=new WebSocket(e);else{if(!("MozWebSocket"in window))return void a.show({type:"error",title:"Error: WebSocket is not supported by this browser."});d.socket=new MozWebSocket(e)}d.socket.onopen=function(){t.initEvent()},d.socket.onclose=function(){document.getElementById("message").onkeydown=null,a.show({type:"error",title:"Info: WebSocket closed."})},d.socket.onmessage=function(e){var n=JSON.parse(e.data);console.log(n),t.addMessage(n)}},sendMessage:function(){var e=this,t=$.trim($("#message").text()),n={message:t,userId:s,datingId:r};t&&s&&r&&(d.socket.send(JSON.stringify(n)),$("#message").text(""),e.updateChatHeight())},addMessage:function(e){var t=this,n=$(".chat-messages"),a=$(".chat-messages-list");if(""==c||""!=c&&new Date(e.sendTime).getTime()-c>18e4){var i=t.handleTime(e.sendTime);$("<li/>").addClass("chat-time").html("<span>"+i+"</span>").appendTo(a)}c=new Date(e.sendTime).getTime();var o=$("<li/>").addClass("chat-message "+(e.self?"chat-message-self":"chat-message-friend")).appendTo(a),s=$("<div/>").addClass("chat-message-avatar").appendTo(o),r=$("<div/>").addClass("chat-message-bubble").appendTo(o);return s.html('<a href="./profile.html?id='+e.fromUserId+'"><img src="'+e.avatar+'_s60" alt="" /></a>'),r.html(e.message||e.msg),n.scrollTop(9999999),{$container:o,$bubble:r}},handleTime:function(e){var n=t.strToDate(e),a=n.getFullYear(),i=n.getMonth()+1,o=n.getDate(),s=n.getHours(),r=n.getMinutes(),c=n.getSeconds();return 10>i&&(i="0"+i),10>o&&(o="0"+o),10>s&&(s="0"+s),10>r&&(r="0"+r),10>c&&(c="0"+c),a+"年"+i+"月"+o+"日 "+s+":"+r},updateChatHeight:function(){$(".chat-messages").css({height:$(window).height()-$(".chat-input-bar").height()})},initEvent:function(){var e=this;document.addEventListener("DOMContentLoaded",function(){for(var e=document.getElementsByClassName("noscript"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},!1),document.getElementById("message").onkeydown=function(e){13==e.keyCode&&d.sendMessage()},$(document).on("tap","#sendBtn",function(){d.sendMessage()}),t.isWeixin()||$(".chat-input").on("input",function(){e.updateChatHeight()})},getDetail:function(){var e={2:"icon-coffee",3:"icon-food",4:"icon-film",5:"icon-run",6:"icon-photo",7:"icon-badminton",8:"icon-riding",9:"icon-drive",11:"icon-flight",1:"icon-lquote"},t={2:"喝咖啡/茶",3:"美食",4:"看电影",5:"跑步",6:"摄影",7:"羽毛球",8:"骑行",9:"自驾",11:"同行",1:"其他"};apiData={userId:s,datingId:r},o.show(),i.get(n.datingDetailApi,apiData,function(n){if(o.hide(),n.result&&n.result.datingInfo){var i=n.result.datingInfo,s=i.datingTime||"",r=i.typeId;if(""!==s)var c=s.substr(0,10);else var c="随时";var d='<li class="chat-message chat-message-theme"><div class="chat-message-bubble"><span class="label"><span class="iconfont icon-lquote"></span> 约吗？</span><br /><span>'+i.article+'</span><br /><span class="what"><span class="iconfont '+e[r]+'"></span>'+t[r]+'</span><span class="time"><span class="iconfont icon-calendar"></span>'+c+"</span></div></li>";$(".chat-messages-list").prepend(d)}else a.show({type:"error",title:"返回的约会数据格式有问题"})},function(e){o.hide()})},getData:function(){var e=this;apiData={userId:s,datingId:r},o.show(),i.get(n.chatRecordsApi,apiData,function(t){if(o.hide(),t.result&&t.result.messageList){var n=t.result.messageList;if(n.length>0)for(var i=0,s=n.length;s>i;i++)e.addMessage(n[i])}else a.show({type:"error",title:"返回的聊天数据格式有问题"})},function(e){o.hide()})}};d.init()})},{"../../common/apimap":1,"../../common/utils":2,"../../components/ajax":3,"../../components/loading/loading":4,"../../components/tips":5}]},{},[6]);